<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESP API: /home/zoe/Mbed Programs/esp_code/mbed-os/connectivity/drivers/ble/FEATURE_BLE/COMPONENT_BlueNRG_2 Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ESP API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_1edf9108190dcb49f45af9734b99102e.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">COMPONENT_BlueNRG_2 Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>HCI driver for BlueNRG_2 <a class="el" href="classBLE.html">BLE</a> component</p>
<p>A simple table like this could help:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Module Name   </th><th class="markdownTableHeadNone">Processor Name   </th><th class="markdownTableHeadNone">Bluetooth compliance   </th><th class="markdownTableHeadNone">Status   </th><th class="markdownTableHeadNone">Used in shields &amp; boards   </th><th class="markdownTableHeadNone">Link    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">SPBTLE-RF   </td><td class="markdownTableBodyNone">BlueNRG-MS (network processor)   </td><td class="markdownTableBodyNone">v4.1   </td><td class="markdownTableBodyNone">Not recommended for new designs   </td><td class="markdownTableBodyNone">X-NUCLEO-IDB05A1, DISCO-L475VG-IOT01A, DISCO-L562QE   </td><td class="markdownTableBodyNone"><a href="https://www.st.com/en/wireless-transceivers-mcus-and-modules/spbtle-rf.html">https://www.st.com/en/wireless-transceivers-mcus-and-modules/spbtle-rf.html</a>    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">BlueNRG-M0   </td><td class="markdownTableBodyNone">BlueNRG-MS (network processor)   </td><td class="markdownTableBodyNone">v4.2   </td><td class="markdownTableBodyNone">Active (included in ST's Longevity Program)   </td><td class="markdownTableBodyNone">X-NUCLEO-IDB05A2   </td><td class="markdownTableBodyNone"><a href="https://www.st.com/en/wireless-transceivers-mcus-and-modules/bluenrg-m0.html">https://www.st.com/en/wireless-transceivers-mcus-and-modules/bluenrg-m0.html</a>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">BlueNRG-M2SP   </td><td class="markdownTableBodyNone">BlueNRG-2 (application processor)   </td><td class="markdownTableBodyNone">v5.0   </td><td class="markdownTableBodyNone">Active (included in ST's Longevity Program)   </td><td class="markdownTableBodyNone">X-NUCLEO-BNRG2A1   </td><td class="markdownTableBodyNone"><a href="https://www.st.com/en/wireless-transceivers-mcus-and-modules/bluenrg-m2.html">https://www.st.com/en/wireless-transceivers-mcus-and-modules/bluenrg-m2.html</a>   </td></tr>
</table>
<p>The library uses ARM Cordio stack. It does not work with the stock firmware that is loaded in the BLUENRG-M2SP <a class="el" href="classBLE.html">BLE</a> module of the X-NUCLEO-BNRG2A1 expansion board.</p>
<p>In order to use this library with X-NUCLEO-BNRG2A1, you need to update the firmware of the BLUENRG-M2SP <a class="el" href="classBLE.html">BLE</a> module mounted on that expansion.</p>
<p>To this aim, attach the X-NUCLEO-BNRG2A1 to the STM32 NUCLEO board through the Arduino Connector. You can use the binary provided for both STM32 NUCLEO-F401RE and STM32 NUCLEO-L476RG.</p>
<p>Download the binaries from the links below:</p>
<p><a href="https://github.com/STMicroelectronics/mbed-ble/blob/master/BlueNRG2_StackUpdater/BLE2_StackUpdater_F401RE.bin">BLE2_StackUpdater_F401RE.bin</a></p>
<p><a href="https://github.com/STMicroelectronics/mbed-ble/blob/master/BlueNRG2_StackUpdater/BLE2_StackUpdater_L476RG.bin">BLE2_StackUpdater_L476RG.bin</a></p>
<p>Before flashing your target board with the respective binary, be careful to properly set the SPI reset on pin <b>D7</b> as reported in the picture below:</p>
<p><img src="img/D7_SPI_rst.jpg" alt="D7_SPI_rst" class="inline"/></p>
<p>At the end of the updating procedure, the LED labeled as <b>LD2</b> on the STM32 NUCLEO board will be blinking. You can also check the status of the updating procedure on the serial terminal (baud rate set to 115200). The picture below shows the log upon success:</p>
<p><img src="img/updLog.jpg" alt="updLog" class="inline"/></p>
<p>If, for some reason, the updating procedure does not succeed you can use a standard ST-Link V2 with 5 jumper wires female-female together with the <a href="https://github.com/STMicroelectronics/mbed-ble/blob/master/BlueNRG2_FlasherUtility/en.STSW_BNRGFLASHER.zip">BlueNRG2_FlasherUtility</a> software tool (currently available only for Windows PC).</p>
<p>You need to connect the J12 pins of the X-NUCLEO-BNRG2A1 to the pins of the ST-Link V2 as shown in the picture below:</p>
<p><img src="img/ST-LINK.jpg" alt="ST-LINK" class="inline"/></p>
<p>In particular, we have the following connections:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Pin number on J12   </th><th class="markdownTableHeadNone">Pin number on ST/Link V2    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">1    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">9    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">3   </td><td class="markdownTableBodyNone">12    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">7    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">5   </td><td class="markdownTableBodyNone">15   </td></tr>
</table>
<p>Install the ST BlueNRG-1_2 Flasher Utility and open it, then select the SWD tab:</p>
<p><img src="img/Flasher_1.jpg" alt="Flasher_1" class="inline"/></p>
<p>Erase the flash memory of the BlueNRG-2 chip:</p>
<p><img src="img/Flasher_2.jpg" alt="Flasher_2" class="inline"/></p>
<p>Download the Firmware for the <a class="el" href="classBLE.html">BLE</a> module from the following link:</p>
<p><a href="https://github.com/STMicroelectronics/mbed-ble/blob/master/BlueNRG2_Firmware/DTM_SPI.hex">DTM_SPI.hex</a></p>
<p>Load the Firmware in the ST BlueNRG-1_2 Flasher Utility and then press the "Flash" button:</p>
<p><img src="img/Flasher_3.jpg" alt="Flasher_3" class="inline"/></p>
<p>If you should find some issues during the update process, you can try to repeat the procedure closing the J15 jumper on the X-NUCLEO-BNRG2A1 expansion board.</p>
<h1><a class="anchor" id="autotoc_md84"></a>
Expansion Board</h1>
<h2><a class="anchor" id="autotoc_md85"></a>
X-NUCLEO-BNRG2A1</h2>
<p>Bluetooth Low Energy Nucleo Expansion Board:</p>
<p><a href="https://os.mbed.com/components/X-NUCLEO-BNRG2A1/">https://os.mbed.com/components/X-NUCLEO-BNRG2A1/</a></p>
<h1><a class="anchor" id="autotoc_md86"></a>
Driver configuration</h1>
<p>In order to use the BlueNRG-M2SP module together with other targets, you may need to override default settings in your local <code>mbed_app.json</code> file</p>
<h2><a class="anchor" id="autotoc_md87"></a>
Arduino Connector Compatibility Warning</h2>
<p>Default Arduino connection is using:</p>
<div class="fragment"><div class="line">&quot;SPI_MOSI&quot;:  &quot;D11&quot;,</div>
<div class="line">&quot;SPI_MISO&quot;:  &quot;D12&quot;,</div>
<div class="line">&quot;SPI_nCS&quot;:   &quot;A1&quot;,</div>
<div class="line">&quot;SPI_RESET&quot;: &quot;D7&quot;,</div>
<div class="line">&quot;SPI_IRQ&quot;:   &quot;A0&quot;,</div>
<div class="line">&quot;SPI_SCK&quot;:   &quot;D3&quot;,</div>
<div class="line">&quot;valid-public-bd-address&quot;: false</div>
</div><!-- fragment --><p>X-NUCLEO-BNRG2A1 is Arduino compatible with an exception: instead of using pin <b>D13</b> for the SPI clock, pin <b>D3</b> is used. The default configuration for this library is having the SPI clock on pin <b>D3</b>.</p>
<p>You should use the jumper labeled as J14 to change the SPI clock pin configuration.</p>
<h3><a class="anchor" id="autotoc_md88"></a>
SPI clock jumper settings</h3>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Settings   </th><th class="markdownTableHeadNone">Pin 1   </th><th class="markdownTableHeadNone">Pin 2   </th><th class="markdownTableHeadNone">Pin 3    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><b>D3</b>   </td><td class="markdownTableBodyNone">Open   </td><td class="markdownTableBodyNone">Short   </td><td class="markdownTableBodyNone">Short    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><b>D13</b>   </td><td class="markdownTableBodyNone">Short   </td><td class="markdownTableBodyNone">Short   </td><td class="markdownTableBodyNone">Open   </td></tr>
</table>
<p>In case you change the default configuration, then you also have to configure this library to use pin <b>D13</b> to drive the SPI clock. To this aim you need to update your local mbed_app.json file with:</p>
<div class="fragment"><div class="line">&quot;target_overrides&quot;: {</div>
<div class="line">    &quot;XXXX&quot;: {</div>
<div class="line">        &quot;SPI_SCK&quot;: &quot;D13&quot;</div>
<div class="line">    },</div>
</div><!-- fragment --><p>If you use pin <b>D13</b> for the SPI clock, please be aware that on some STM32 Nucleo boards you may <b>not</b> drive the LED, otherwise you will get a conflict: the LED on STM32 Nucleo boards is connected to pin <b>D13</b>.</p>
<p>To correctly set the SPI reset on pin <b>D7</b> resistor R117 should be mounted. Alternatively, pin <b>D7</b> of the Arduino connector (<b>CN9</b>) and pin #5 of the jumper labeled as J12 should be bridged.</p>
<h2><a class="anchor" id="autotoc_md89"></a>
Target Configuration</h2>
<p>To use that library, the target requires some extra configuration in the application <code>mbed_app.json</code>. In the <code>target_overides</code> section: <br  />
</p>
<ul>
<li>BlueNRG module has to be enabled</li>
</ul>
<div class="fragment"><div class="line">&quot;target.components_add&quot;: [&quot;BlueNRG_2&quot;]</div>
</div><!-- fragment --><ul>
<li><a class="el" href="classBLE.html">BLE</a> feature has to be enabled</li>
</ul>
<div class="fragment"><div class="line">&quot;target.features_add&quot;: [&quot;BLE&quot;]</div>
</div><!-- fragment --><ul>
<li>Extra labels have to be defined to include the cordio stack and this library:</li>
</ul>
<div class="fragment"><div class="line">&quot;target.extra_labels_add&quot;: [&quot;CORDIO&quot;]</div>
</div><!-- fragment --><p>As an example, the target overide section for the <code>NUCLEO_F401RE</code> would be:</p>
<div class="fragment"><div class="line">&quot;NUCLEO_F401RE&quot;: {</div>
<div class="line">    &quot;target.components_add&quot;: [&quot;BlueNRG_2&quot;],</div>
<div class="line">    &quot;target.features_add&quot;: [&quot;BLE&quot;]</div>
<div class="line">    &quot;target.extra_labels_add&quot;: [&quot;CORDIO&quot;]</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md90"></a>
Known limitations</h2>
<p>Security does not work with privacy due to pairing failure. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5fdebfbd0a4b5643a5e85bf3c8b1558b.html">mbed-os</a></li><li class="navelem"><a class="el" href="dir_456207283565120b441ff9733579e7b8.html">connectivity</a></li><li class="navelem"><a class="el" href="dir_59977a0c207738c890dea4a1d368376e.html">drivers</a></li><li class="navelem"><a class="el" href="dir_01973298b99ae3451d28320b74eaff96.html">ble</a></li><li class="navelem"><a class="el" href="dir_bace2f63c4602e00ca8e2f83c127e6e1.html">FEATURE_BLE</a></li><li class="navelem"><a class="el" href="dir_1edf9108190dcb49f45af9734b99102e.html">COMPONENT_BlueNRG_2</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
