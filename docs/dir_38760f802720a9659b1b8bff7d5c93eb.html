<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESP API: /home/zoe/Mbed Programs/esp_code/mbed-os/storage/filesystem/littlefs/littlefs Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ESP API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('dir_38760f802720a9659b1b8bff7d5c93eb.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">littlefs Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_26d2d54f1a4e348c555638267ef057fa.html">emubd</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_47a0fb5ae2db1997465110bfa4077c89.html">scripts</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><span class="iconfclosed"></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_69eb966f9e45c179a9ec5470c7848a74.html">tests</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="lfs_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>lfs.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top"><a href="lfs__util_8h_source.html"><span class="icondoc"></span></a>&#160;</td><td class="memItemRight" valign="bottom"><b>lfs_util.h</b></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>A little fail-safe filesystem designed for embedded systems.</p>
<div class="fragment"><div class="line">   | | |     .---._____</div>
<div class="line">  .-----.   |          |</div>
<div class="line">--|o    |---| littlefs |</div>
<div class="line">--|     |---|          |</div>
<div class="line">  &#39;-----&#39;   &#39;----------&#39;</div>
<div class="line">   | | |</div>
</div><!-- fragment --><p><b>Bounded RAM/ROM</b> - The littlefs is designed to work with a limited amount of memory. Recursion is avoided, and dynamic memory is limited to configurable buffers that can be provided statically.</p>
<p><b>Power-loss resilient</b> - The littlefs is designed for systems that may have random power failures. The littlefs has strong copy-on-write guarantees, and storage on disk is always kept in a valid state.</p>
<p><b>Wear leveling</b> - Because the most common form of embedded storage is erodible flash memories, littlefs provides a form of dynamic wear leveling for systems that cannot fit a full flash translation layer.</p>
<h1><a class="anchor" id="autotoc_md1022"></a>
Example</h1>
<p>Here's a simple example that updates a file named <code>boot_count</code> every time main runs. The program can be interrupted at any time without losing track of how many times it has been booted and without corrupting the filesystem:</p>
<div class="fragment"><div class="line"> c</div>
<div class="line">#include &quot;lfs.h&quot;</div>
<div class="line"> </div>
<div class="line">// variables used by the filesystem</div>
<div class="line">lfs_t lfs;</div>
<div class="line">lfs_file_t file;</div>
<div class="line"> </div>
<div class="line">// configuration of the filesystem is provided by this struct</div>
<div class="line">const struct lfs_config cfg = {</div>
<div class="line">    // block device operations</div>
<div class="line">    .read  = user_provided_block_device_read,</div>
<div class="line">    .prog  = user_provided_block_device_prog,</div>
<div class="line">    .erase = user_provided_block_device_erase,</div>
<div class="line">    .sync  = user_provided_block_device_sync,</div>
<div class="line"> </div>
<div class="line">    // block device configuration</div>
<div class="line">    .read_size = 16,</div>
<div class="line">    .prog_size = 16,</div>
<div class="line">    .block_size = 4096,</div>
<div class="line">    .block_count = 128,</div>
<div class="line">    .lookahead = 128,</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line">// entry point</div>
<div class="line">int main(void) {</div>
<div class="line">    // mount the filesystem</div>
<div class="line">    int err = lfs_mount(&amp;lfs, &amp;cfg);</div>
<div class="line"> </div>
<div class="line">    // reformat if we can&#39;t mount the filesystem</div>
<div class="line">    // this should only happen on the first boot</div>
<div class="line">    if (err) {</div>
<div class="line">        lfs_format(&amp;lfs, &amp;cfg);</div>
<div class="line">        lfs_mount(&amp;lfs, &amp;cfg);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    // read current count</div>
<div class="line">    uint32_t boot_count = 0;</div>
<div class="line">    lfs_file_open(&amp;lfs, &amp;file, &quot;boot_count&quot;, LFS_O_RDWR | LFS_O_CREAT);</div>
<div class="line">    lfs_file_read(&amp;lfs, &amp;file, &amp;boot_count, sizeof(boot_count));</div>
<div class="line"> </div>
<div class="line">    // update boot count</div>
<div class="line">    boot_count += 1;</div>
<div class="line">    lfs_file_rewind(&amp;lfs, &amp;file);</div>
<div class="line">    lfs_file_write(&amp;lfs, &amp;file, &amp;boot_count, sizeof(boot_count));</div>
<div class="line"> </div>
<div class="line">    // remember the storage is not updated until the file is closed successfully</div>
<div class="line">    lfs_file_close(&amp;lfs, &amp;file);</div>
<div class="line"> </div>
<div class="line">    // release any resources we were using</div>
<div class="line">    lfs_unmount(&amp;lfs);</div>
<div class="line"> </div>
<div class="line">    // print the boot count</div>
<div class="line">    printf(&quot;boot_count: %d\n&quot;, boot_count);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1023"></a>
Usage</h1>
<p>Detailed documentation (or at least as much detail as is currently available) can be found in the comments in <a href="lfs.h">lfs.h</a>.</p>
<p>As you may have noticed, littlefs takes in a configuration structure that defines how the filesystem operates. The configuration struct provides the filesystem with the block device operations and dimensions, tweakable parameters that trade memory usage for performance and optional static buffers if the user wants to avoid dynamic memory.</p>
<p>The state of the littlefs is stored in the <code>lfs_t</code> type, which is left up to the user to allocate, allowing multiple filesystems to be in use simultaneously. With the <code>lfs_t</code> and configuration struct, a user can format a block device or mount the filesystem.</p>
<p>Once mounted, the littlefs provides a full set of POSIX-like file and directory functions, with the deviation that the allocation of filesystem structures must be provided by the user.</p>
<p>All POSIX operations, such as remove and rename, are atomic, even in event of power loss. Additionally, no file updates are actually committed to the filesystem until sync or close is called on the file.</p>
<h1><a class="anchor" id="autotoc_md1024"></a>
Other notes</h1>
<p>All littlefs calls have the potential to return a negative error code. The errors can be either one of those found in the <code>enum lfs_error</code> in <a href="lfs.h">lfs.h</a>, or an error returned by the user's block device operations.</p>
<p>In the configuration struct, the <code>prog</code> and <code>erase</code> function provided by the user may return a <code>LFS_ERR_CORRUPT</code> error if the implementation already can detect corrupt blocks. However, the wear leveling does not depend on the return code of these functions, instead all data is read back and checked for integrity.</p>
<p>If your storage caches writes, make sure that the provided <code>sync</code> function flushes all the data to memory and ensures that the next read fetches the data from memory, otherwise data integrity can not be guaranteed. If the <code>write</code> function does not perform caching, and therefore each <code>read</code> or <code>write</code> call hits the memory, the <code>sync</code> function can simply return 0.</p>
<h1><a class="anchor" id="autotoc_md1025"></a>
Reference material</h1>
<p><a class="el" href="md__2home_2zoe_2Mbed_01Programs_2esp__code_2mbed-os_2storage_2filesystem_2littlefs_2littlefs_2DESIGN.html">DESIGN.md</a> - DESIGN.md contains a fully detailed dive into how littlefs actually works. We would encourage you to read it because the solutions and tradeoffs at work here are quite interesting.</p>
<p><a class="el" href="md__2home_2zoe_2Mbed_01Programs_2esp__code_2mbed-os_2storage_2filesystem_2littlefs_2littlefs_2SPEC.html">SPEC.md</a> - SPEC.md contains the on-disk specification of littlefs with all the nitty-gritty details. This can be useful for developing tooling.</p>
<h1><a class="anchor" id="autotoc_md1026"></a>
Testing</h1>
<p>The littlefs comes with a test suite designed to run on a PC using the <a href="emubd/lfs_emubd.h">emulated block device</a> found in the emubd directory. The tests assume a Linux environment and can be started with make:</p>
<div class="fragment"><div class="line"> bash</div>
<div class="line">make test</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1027"></a>
License</h1>
<p>The littlefs is provided under the <a href="https://spdx.org/licenses/BSD-3-Clause.html">BSD-3-Clause</a> license. See <a class="el" href="md__2home_2zoe_2Mbed_01Programs_2esp__code_2mbed-os_2storage_2filesystem_2littlefs_2littlefs_2LICENSE.html">LICENSE.md</a> for more information. Contributions to this project are accepted under the same license.</p>
<p>Individual files contain the following tag instead of the full license text. </p><pre class="fragment">SPDX-License-Identifier:    BSD-3-Clause
</pre><p>This enables machine processing of license information based on the SPDX License Identifiers that are here available: <a href="http://spdx.org/licenses/">http://spdx.org/licenses/</a></p>
<h1><a class="anchor" id="autotoc_md1028"></a>
Related projects</h1>
<p><a href="https://github.com/ARMmbed/mbed-os/tree/master/features/filesystem/littlefs">Mbed OS</a> - The easiest way to get started with littlefs is to jump into <a href="https://os.mbed.com/">Mbed</a>, which already has block device drivers for most forms of embedded storage. The littlefs is available in Mbed OS as the <a href="https://os.mbed.com/docs/latest/reference/littlefilesystem.html">LittleFileSystem</a> class.</p>
<p><a href="https://github.com/geky/littlefs-fuse">littlefs-fuse</a> - A <a href="https://github.com/libfuse/libfuse">FUSE</a> wrapper for littlefs. The project allows you to mount littlefs directly on a Linux machine. Can be useful for debugging littlefs if you have an SD card handy.</p>
<p><a href="https://github.com/geky/littlefs-js">littlefs-js</a> - A JavaScript wrapper for littlefs. I'm not sure why you would want this, but it is handy for demos. You can see it in action <a href="http://littlefs.geky.net/demo.html">here</a>.</p>
<p><a href="https://github.com/whitecatboard/Lua-RTOS-ESP32/tree/master/components/mklfs/src">mklfs</a> - A command line tool built by the <a href="https://github.com/whitecatboard/Lua-RTOS-ESP32">Lua RTOS</a> guys for making littlefs images from a host PC. Supports Windows, Mac OS, and Linux.</p>
<p><a href="https://github.com/pellepl/spiffs">SPIFFS</a> - Another excellent embedded filesystem for NOR flash. As a more traditional logging filesystem with full static wear-leveling, SPIFFS will likely outperform littlefs on small memories such as the internal flash on microcontrollers.</p>
<p><a href="https://github.com/dlbeer/dhara">Dhara</a> - An interesting NAND flash translation layer designed for small MCUs. It offers static wear-leveling and power-resilience with only a fixed O(|address|) pointer structure stored on each block and in RAM. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5fdebfbd0a4b5643a5e85bf3c8b1558b.html">mbed-os</a></li><li class="navelem"><a class="el" href="dir_80349e94800a79a1c710cf3d270cb12e.html">storage</a></li><li class="navelem"><a class="el" href="dir_ac73eca27924dbea0696e9dea05b9067.html">filesystem</a></li><li class="navelem"><a class="el" href="dir_f34a4b46aff5183c6e4d0971fa0970a6.html">littlefs</a></li><li class="navelem"><a class="el" href="dir_38760f802720a9659b1b8bff7d5c93eb.html">littlefs</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
