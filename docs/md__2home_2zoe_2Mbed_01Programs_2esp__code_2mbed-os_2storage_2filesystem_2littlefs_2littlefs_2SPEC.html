<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESP API: The little filesystem technical specification</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ESP API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__2home_2zoe_2Mbed_01Programs_2esp__code_2mbed-os_2storage_2filesystem_2littlefs_2littlefs_2SPEC.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">The little filesystem technical specification</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md1029"></a></p>
<p>This is the technical specification of the little filesystem. This document covers the technical details of how the littlefs is stored on disk for introspection and tooling development. This document assumes you are familiar with the design of the littlefs. For more information on how littlefs works, check out <a class="el" href="md__2home_2zoe_2Mbed_01Programs_2esp__code_2mbed-os_2storage_2filesystem_2littlefs_2littlefs_2DESIGN.html">DESIGN.md</a>.</p>
<div class="fragment"><div class="line">   | | |     .---._____</div>
<div class="line">  .-----.   |          |</div>
<div class="line">--|o    |---| littlefs |</div>
<div class="line">--|     |---|          |</div>
<div class="line">  &#39;-----&#39;   &#39;----------&#39;</div>
<div class="line">   | | |</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1030"></a>
Some important details</h1>
<ul>
<li>The littlefs is a block-based filesystem. The disk is divided into an array of evenly sized blocks that are used as the logical unit of storage in littlefs. Block pointers are stored in 32 bits.</li>
<li>There is no explicit free-list stored on disk. The littlefs only knows what is in use in the filesystem.</li>
<li>The littlefs uses the value of 0xffffffff to represent a null block-pointer.</li>
<li>All values in littlefs are stored in little-endian byte order.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1031"></a>
Directories/Metadata pairs</h1>
<p>Metadata pairs form the backbone of the littlefs and provide a system for atomic updates. Even the superblock is stored in a metadata pair.</p>
<p>As its name suggests, a metadata pair is stored in two blocks, with one block acting as a redundant backup in case the other is corrupted. These two blocks could be anywhere in the disk and may not be next to each other, so any pointers to directory pairs need to be stored as two block pointers.</p>
<p>Here's the layout of metadata blocks on disk:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">offset   </th><th class="markdownTableHeadNone">size   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x00   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">revision count    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x04   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">dir size    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x08   </td><td class="markdownTableBodyNone">64 bits   </td><td class="markdownTableBodyNone">tail pointer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x10   </td><td class="markdownTableBodyNone">size-16 bytes   </td><td class="markdownTableBodyNone">dir entries    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x00+s   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">CRC   </td></tr>
</table>
<p><b>Revision count</b> - Incremented every update, only the uncorrupted metadata-block with the most recent revision count contains the valid metadata. Comparison between revision counts must use sequence comparison because the revision counts may overflow.</p>
<p><b>Dir size</b> - Size in bytes of the contents in the current metadata block, including the metadata-pair metadata. Additionally, the highest bit of the dir size may be set to indicate that the directory's contents continue on the next metadata-pair pointed to by the tail pointer.</p>
<p><b>Tail pointer</b> - Pointer to the next metadata-pair in the filesystem. A null pair-pointer (0xffffffff, 0xffffffff) indicates the end of the list. If the highest bit in the dir size is set, this points to the next metadata-pair in the current directory. Otherwise, it points to an arbitrary metadata-pair. Starting with the superblock, the tail-pointers form a linked-list containing all metadata-pairs in the filesystem.</p>
<p><b>CRC</b> - 32 bit CRC used to detect corruption from power-lost, from block end-of-life or just from noise on the storage bus. The CRC is appended to the end of each metadata-block. The littlefs uses the standard CRC-32, which uses a polynomial of 0x04c11db7, initialized with 0xffffffff.</p>
<p>Here's an example of a simple directory stored on disk: </p><div class="fragment"><div class="line">(32 bits) revision count = 10                    (0x0000000a)</div>
<div class="line">(32 bits) dir size       = 154 bytes, end of dir (0x0000009a)</div>
<div class="line">(64 bits) tail pointer   = 37, 36                (0x00000025, 0x00000024)</div>
<div class="line">(32 bits) CRC            = 0xc86e3106</div>
<div class="line"> </div>
<div class="line">00000000: 0a 00 00 00 9a 00 00 00 25 00 00 00 24 00 00 00  ........%...$...</div>
<div class="line">00000010: 22 08 00 03 05 00 00 00 04 00 00 00 74 65 61 22  &quot;...........tea&quot;</div>
<div class="line">00000020: 08 00 06 07 00 00 00 06 00 00 00 63 6f 66 66 65  ...........coffe</div>
<div class="line">00000030: 65 22 08 00 04 09 00 00 00 08 00 00 00 73 6f 64  e&quot;...........sod</div>
<div class="line">00000040: 61 22 08 00 05 1d 00 00 00 1c 00 00 00 6d 69 6c  a&quot;...........mil</div>
<div class="line">00000050: 6b 31 22 08 00 05 1f 00 00 00 1e 00 00 00 6d 69  k1&quot;...........mi</div>
<div class="line">00000060: 6c 6b 32 22 08 00 05 21 00 00 00 20 00 00 00 6d  lk2&quot;...!... ...m</div>
<div class="line">00000070: 69 6c 6b 33 22 08 00 05 23 00 00 00 22 00 00 00  ilk3&quot;...#...&quot;...</div>
<div class="line">00000080: 6d 69 6c 6b 34 22 08 00 05 25 00 00 00 24 00 00  milk4&quot;...%...$..</div>
<div class="line">00000090: 00 6d 69 6c 6b 35 06 31 6e c8                    .milk5.1n.</div>
</div><!-- fragment --><p>A note about the tail pointer linked-list: Normally, this linked-list is threaded through the entire filesystem. However, after power loss, this linked-list may become out of sync with the rest of the filesystem.</p><ul>
<li>The linked-list may contain a directory that has actually been removed.</li>
<li>The linked-list may contain a metadata pair that has not been updated after a block in the pair has gone bad.</li>
</ul>
<p>The threaded linked-list must be checked for these errors before it can be used reliably. Fortunately, the threaded linked-list can simply be ignored if littlefs is mounted read-only.</p>
<h1><a class="anchor" id="autotoc_md1032"></a>
Entries</h1>
<p>Each metadata block contains a series of entries that follow a standard layout. An entry contains the type of the entry, along with a section for entry-specific data, attributes and a name.</p>
<p>Here's the layout of entries on disk:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">offset   </th><th class="markdownTableHeadNone">size   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x0   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry type    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x1   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry length    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x2   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">attribute length    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x3   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">name length    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x4   </td><td class="markdownTableBodyNone">entry length bytes   </td><td class="markdownTableBodyNone">entry-specific data    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x4+e   </td><td class="markdownTableBodyNone">attribute length bytes   </td><td class="markdownTableBodyNone">system-specific attributes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x4+e+a   </td><td class="markdownTableBodyNone">name length bytes   </td><td class="markdownTableBodyNone">entry name   </td></tr>
</table>
<p><b>Entry type</b> - Type of the entry, currently this is limited to the following:</p><ul>
<li>0x11 - file entry.</li>
<li>0x22 - directory entry.</li>
<li>0x2e - superblock entry.</li>
</ul>
<p>Additionally, the type is broken into two 4 bit nibbles, with the upper nibble specifying the type's data structure used when scanning the filesystem. The lower nibble clarifies the type further when multiple entries share the same data structure.</p>
<p>The highest bit is reserved for marking the entry as "moved". If an entry is marked as "moved", the entry may also exist somewhere else in the filesystem. If the entry exists elsewhere, this entry must be treated as though it does not exist.</p>
<p><b>Entry length</b> - Length in bytes of the entry-specific data. This does not include the entry type size, attributes or name. The full size in bytes of the entry is 4 plus entry length plus attribute length plus name length.</p>
<p><b>Attribute length</b> - Length of system-specific attributes in bytes. Because attributes are system specific, there is not much guarantee on the values in this section, and systems are expected to work even when it is empty. See the attributes section for more details.</p>
<p><b>Name length</b> - Length of the entry name. Entry names are stored as UTF8, though most systems will probably only support ASCII. Entry names can not contain '/' and can not be '.' or '..' because these are a part of the syntax of filesystem paths.</p>
<p>Here's an example of a simple entry stored on disk: </p><div class="fragment"><div class="line">(8 bits)   entry type       = file     (0x11)</div>
<div class="line">(8 bits)   entry length     = 8 bytes  (0x08)</div>
<div class="line">(8 bits)   attribute length = 0 bytes  (0x00)</div>
<div class="line">(8 bits)   name length      = 12 bytes (0x0c)</div>
<div class="line">(8 bytes)  entry data       = 05 00 00 00 20 00 00 00</div>
<div class="line">(12 bytes) entry name       = smallavacado</div>
<div class="line"> </div>
<div class="line">00000000: 11 08 00 0c 05 00 00 00 20 00 00 00 73 6d 61 6c  ........ ...smal</div>
<div class="line">00000010: 6c 61 76 61 63 61 64 6f                          lavacado</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1033"></a>
Superblock</h1>
<p>The superblock is the anchor for the littlefs. The superblock is stored as a metadata pair containing a single superblock entry. It is through the superblock that littlefs can access the rest of the filesystem.</p>
<p>The superblock can always be found in blocks 0 and 1; however, fetching the superblock requires knowing the block size. The block size can be guessed by searching the beginning of disk for the string "littlefs", though currently, the filesystems relies on the user providing the correct block size.</p>
<p>The superblock is the most valuable block in the filesystem. It is updated very rarely, only during format or when the root directory must be moved. It is encouraged to always write out both superblock pairs even though it is not required.</p>
<p>Here's the layout of the superblock entry:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">offset   </th><th class="markdownTableHeadNone">size   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x00   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry type (0x2e for superblock entry)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x01   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry length (20 bytes)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x02   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">attribute length    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x03   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">name length (8 bytes)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x04   </td><td class="markdownTableBodyNone">64 bits   </td><td class="markdownTableBodyNone">root directory    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x0c   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">block size    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x10   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">block count    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x14   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">version    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x18   </td><td class="markdownTableBodyNone">attribute length bytes   </td><td class="markdownTableBodyNone">system-specific attributes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x18+a   </td><td class="markdownTableBodyNone">8 bytes   </td><td class="markdownTableBodyNone">magic string ("littlefs")   </td></tr>
</table>
<p><b>Root directory</b> - Pointer to the root directory's metadata pair.</p>
<p><b>Block size</b> - Size of the logical block size used by the filesystem.</p>
<p><b>Block count</b> - Number of blocks in the filesystem.</p>
<p><b>Version</b> - The littlefs version encoded as a 32 bit value. The upper 16 bits encodes the major version, which is incremented when a breaking-change is introduced in the filesystem specification. The lower 16 bits encodes the minor version, which is incremented when a backward-compatible change is introduced. Nonstandard Attribute changes do not change the version. This specification describes version 1.1 (0x00010001), which is the first version of littlefs.</p>
<p><b>Magic string</b> - The magic string "littlefs" takes the place of an entry name.</p>
<p>Here's an example of a complete superblock: </p><div class="fragment"><div class="line">(32 bits) revision count   = 3                    (0x00000003)</div>
<div class="line">(32 bits) dir size         = 52 bytes, end of dir (0x00000034)</div>
<div class="line">(64 bits) tail pointer     = 3, 2                 (0x00000003, 0x00000002)</div>
<div class="line">(8 bits)  entry type       = superblock           (0x2e)</div>
<div class="line">(8 bits)  entry length     = 20 bytes             (0x14)</div>
<div class="line">(8 bits)  attribute length = 0 bytes              (0x00)</div>
<div class="line">(8 bits)  name length      = 8 bytes              (0x08)</div>
<div class="line">(64 bits) root directory   = 3, 2                 (0x00000003, 0x00000002)</div>
<div class="line">(32 bits) block size       = 512 bytes            (0x00000200)</div>
<div class="line">(32 bits) block count      = 1024 blocks          (0x00000400)</div>
<div class="line">(32 bits) version          = 1.1                  (0x00010001)</div>
<div class="line">(8 bytes) magic string     = littlefs</div>
<div class="line">(32 bits) CRC              = 0xc50b74fa</div>
<div class="line"> </div>
<div class="line">00000000: 03 00 00 00 34 00 00 00 03 00 00 00 02 00 00 00  ....4...........</div>
<div class="line">00000010: 2e 14 00 08 03 00 00 00 02 00 00 00 00 02 00 00  ................</div>
<div class="line">00000020: 00 04 00 00 01 00 01 00 6c 69 74 74 6c 65 66 73  ........littlefs</div>
<div class="line">00000030: fa 74 0b c5                                      .t..</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1034"></a>
Directory entries</h1>
<p>Directories are stored in entries with a pointer to the first metadata pair in the directory. Keep in mind that a directory may be composed of multiple metadata pairs connected by the tail pointer when the highest bit in the dir size is set.</p>
<p>Here's the layout of a directory entry:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">offset   </th><th class="markdownTableHeadNone">size   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x0   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry type (0x22 for directory entries)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x1   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry length (8 bytes)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x2   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">attribute length    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x3   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">name length    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x4   </td><td class="markdownTableBodyNone">64 bits   </td><td class="markdownTableBodyNone">directory pointer    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xc   </td><td class="markdownTableBodyNone">attribute length bytes   </td><td class="markdownTableBodyNone">system-specific attributes    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xc+a   </td><td class="markdownTableBodyNone">name length bytes   </td><td class="markdownTableBodyNone">directory name   </td></tr>
</table>
<p><b>Directory pointer</b> - Pointer to the first metadata pair in the directory.</p>
<p>Here's an example of a directory entry: </p><div class="fragment"><div class="line">(8 bits)  entry type        = directory (0x22)</div>
<div class="line">(8 bits)  entry length      = 8 bytes   (0x08)</div>
<div class="line">(8 bits)  attribute length  = 0 bytes   (0x00)</div>
<div class="line">(8 bits)  name length       = 3 bytes   (0x03)</div>
<div class="line">(64 bits) directory pointer = 5, 4      (0x00000005, 0x00000004)</div>
<div class="line">(3 bytes) name              = tea</div>
<div class="line"> </div>
<div class="line">00000000: 22 08 00 03 05 00 00 00 04 00 00 00 74 65 61     &quot;...........tea</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1035"></a>
File entries</h1>
<p>Files are stored in entries with a pointer to the head of the file and the size of the file. This is enough information to determine the state of the CTZ skip-list that is being referenced.</p>
<p>How files are actually stored on disk is a bit complicated. The full explanation of CTZ skip-lists can be found in <a href="DESIGN.md#ctz-skip-lists">DESIGN.md</a>.</p>
<p>A terribly quick summary: For every nth block where n is divisible by 2^x, the block contains a pointer to block n-2^x. These pointers are stored in increasing order of x in each block of the file preceding the data in the block.</p>
<p>The maximum number of pointers in a block is bounded by the maximum file size divided by the block size. With 32 bits for file size, this results in a minimum block size of 104 bytes.</p>
<p>Here's the layout of a file entry:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">offset   </th><th class="markdownTableHeadNone">size   </th><th class="markdownTableHeadNone">description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x0   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry type (0x11 for file entries)    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x1   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">entry length (8 bytes)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x2   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">attribute length    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x3   </td><td class="markdownTableBodyNone">8 bits   </td><td class="markdownTableBodyNone">name length    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x4   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">file head    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x8   </td><td class="markdownTableBodyNone">32 bits   </td><td class="markdownTableBodyNone">file size    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0xc   </td><td class="markdownTableBodyNone">attribute length bytes   </td><td class="markdownTableBodyNone">system-specific attributes    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0xc+a   </td><td class="markdownTableBodyNone">name length bytes   </td><td class="markdownTableBodyNone">directory name   </td></tr>
</table>
<p><b>File head</b> - Pointer to the block that is the head of the file's CTZ skip-list.</p>
<p><b>File size</b> - Size of file in bytes.</p>
<p>Here's an example of a file entry: </p><div class="fragment"><div class="line">(8 bits)   entry type       = file     (0x11)</div>
<div class="line">(8 bits)   entry length     = 8 bytes  (0x08)</div>
<div class="line">(8 bits)   attribute length = 0 bytes  (0x00)</div>
<div class="line">(8 bits)   name length      = 12 bytes (0x03)</div>
<div class="line">(32 bits)  file head        = 543      (0x0000021f)</div>
<div class="line">(32 bits)  file size        = 256 KB   (0x00040000)</div>
<div class="line">(12 bytes) name             = largeavacado</div>
<div class="line"> </div>
<div class="line">00000000: 11 08 00 0c 1f 02 00 00 00 00 04 00 6c 61 72 67  ............larg</div>
<div class="line">00000010: 65 61 76 61 63 61 64 6f                          eavacado</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1036"></a>
Entry attributes</h1>
<p>Each dir entry can have up to 256 bytes of system-specific attributes. Because these attributes are system-specific, they may not be portable between different systems. For this reason, all attributes must be optional. A minimal littlefs driver must be able to get away with supporting no attributes at all.</p>
<p>For some level of portability, littlefs has a simple scheme for attributes. Each attribute is prefixed with an 8-bit type that indicates what the attribute is. The length of attributes may also be determined from this type. Attributes in an entry should be sorted based on portability because attribute parsing will end when it hits the first attribute it does not understand.</p>
<p>Each system should choose a 4-bit value to prefix all attribute types with to avoid conflicts with other systems. Additionally, littlefs drivers that support attributes should provide an "ignore attributes" flag to users in case attribute conflicts do occur.</p>
<p>Attribute types prefixes with 0x0 and 0xf are currently reserved for future standard attributes. Standard attributes will be added to this document in that case.</p>
<p>Here's an example of nonstandard time attribute: </p><div class="fragment"><div class="line">(8 bits)  attribute type  = time       (0xc1)</div>
<div class="line">(72 bits) time in seconds = 1506286115 (0x0059c81a23)</div>
<div class="line"> </div>
<div class="line">00000000: c1 23 1a c8 59 00                                .#..Y.</div>
</div><!-- fragment --><p>Here's an example of nonstandard permissions attribute: </p><div class="fragment"><div class="line">(8 bits)  attribute type  = permissions (0xc2)</div>
<div class="line">(16 bits) permission bits = rw-rw-r--   (0x01b4)</div>
<div class="line"> </div>
<div class="line">00000000: c2 b4 01                                         ...</div>
</div><!-- fragment --><p>Here's what a dir entry may look like with these attributes: </p><div class="fragment"><div class="line">(8 bits)   entry type       = file         (0x11)</div>
<div class="line">(8 bits)   entry length     = 8 bytes      (0x08)</div>
<div class="line">(8 bits)   attribute length = 9 bytes      (0x09)</div>
<div class="line">(8 bits)   name length      = 12 bytes     (0x0c)</div>
<div class="line">(8 bytes)  entry data       = 05 00 00 00 20 00 00 00</div>
<div class="line">(8 bits)   attribute type   = time         (0xc1)</div>
<div class="line">(72 bits)  time in seconds  = 1506286115   (0x0059c81a23)</div>
<div class="line">(8 bits)   attribute type   = permissions  (0xc2)</div>
<div class="line">(16 bits)  permission bits  = rw-rw-r--    (0x01b4)</div>
<div class="line">(12 bytes) entry name       = smallavacado</div>
<div class="line"> </div>
<div class="line">00000000: 11 08 09 0c 05 00 00 00 20 00 00 00 c1 23 1a c8  ........ ....#..</div>
<div class="line">00000010: 59 00 c2 b4 01 73 6d 61 6c 6c 61 76 61 63 61 64  Y....smallavacad</div>
<div class="line">00000020: 6f                                               o</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
