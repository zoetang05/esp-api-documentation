<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ESP API: /home/zoe/Mbed Programs/esp_code/mbed-os/platform/FEATURE_EXPERIMENTAL_API/FEATURE_PSA/TARGET_MBED_PSA_SRV/services/attestation/tfm_impl/t_cose/src/t_cose_util.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ESP API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('t__cose__util_8h.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">t_cose_util.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Utility functions used internally by the t_cose implementation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &quot;<a class="el" href="useful__buf_8h_source.html">useful_buf.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="t__cose__common_8h_source.html">t_cose_common.h</a>&quot;</code><br />
</div>
<p><a href="t__cose__util_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a92ba383acc7ea564561e83eb6aac7345" id="r_a92ba383acc7ea564561e83eb6aac7345"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a92ba383acc7ea564561e83eb6aac7345">T_COSE_SHORT_CIRCUIT_KID_SIZE</a>&#160;&#160;&#160;32</td></tr>
<tr class="separator:a92ba383acc7ea564561e83eb6aac7345"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a63d86375cb59d1a36b01b943a27790bf" id="r_a63d86375cb59d1a36b01b943a27790bf"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a63d86375cb59d1a36b01b943a27790bf">hash_alg_id_from_sig_alg_id</a> (int32_t cose_sig_alg_id)</td></tr>
<tr class="memdesc:a63d86375cb59d1a36b01b943a27790bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return hash algorithm ID from a signature algorithm ID.  <br /></td></tr>
<tr class="separator:a63d86375cb59d1a36b01b943a27790bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeb79af34828eaf45ee44af264f591138" id="r_aeb79af34828eaf45ee44af264f591138"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aeb79af34828eaf45ee44af264f591138">create_tbs_hash</a> (int32_t cose_alg_id, struct <a class="el" href="structuseful__buf.html">useful_buf</a> buffer_for_hash, struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a> *hash, struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a> protected_headers, struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a> payload)</td></tr>
<tr class="memdesc:aeb79af34828eaf45ee44af264f591138"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create the hash of the to-be-signed (TBS) bytes for COSE.  <br /></td></tr>
<tr class="separator:aeb79af34828eaf45ee44af264f591138"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12cfd92c0a1b8b770c6c94a34fb8132c" id="r_a12cfd92c0a1b8b770c6c94a34fb8132c"><td class="memItemLeft" align="right" valign="top">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a12cfd92c0a1b8b770c6c94a34fb8132c">get_short_circuit_kid</a> (struct <a class="el" href="structuseful__buf.html">useful_buf</a> buffer_for_kid, struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a> *kid)</td></tr>
<tr class="memdesc:a12cfd92c0a1b8b770c6c94a34fb8132c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the special kid for short-circuit signing.  <br /></td></tr>
<tr class="separator:a12cfd92c0a1b8b770c6c94a34fb8132c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Utility functions used internally by the t_cose implementation. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a92ba383acc7ea564561e83eb6aac7345" name="a92ba383acc7ea564561e83eb6aac7345"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a92ba383acc7ea564561e83eb6aac7345">&#9670;&#160;</a></span>T_COSE_SHORT_CIRCUIT_KID_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define T_COSE_SHORT_CIRCUIT_KID_SIZE&#160;&#160;&#160;32</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Size of the key returned by <a class="el" href="#a12cfd92c0a1b8b770c6c94a34fb8132c" title="Get the special kid for short-circuit signing.">get_short_circuit_kid()</a>. It is always this size. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aeb79af34828eaf45ee44af264f591138" name="aeb79af34828eaf45ee44af264f591138"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb79af34828eaf45ee44af264f591138">&#9670;&#160;</a></span>create_tbs_hash()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> create_tbs_hash </td>
          <td>(</td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>cose_alg_id</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structuseful__buf.html">useful_buf</a></td>          <td class="paramname"><span class="paramname"><em>buffer_for_hash</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a> *</td>          <td class="paramname"><span class="paramname"><em>hash</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a></td>          <td class="paramname"><span class="paramname"><em>protected_headers</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a></td>          <td class="paramname"><span class="paramname"><em>payload</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create the hash of the to-be-signed (TBS) bytes for COSE. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_alg_id</td><td>The COSE signing algorithm ID. Used to determine which hash function to use. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer_for_hash</td><td>Pointer and length of buffer into which the resulting hash is put. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">hash</td><td>Pointer and length of the resulting hash. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">protected_headers</td><td>The CBOR encoded protected headers. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">payload</td><td>The CBOR encoded payload</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>This returns one of the error codes defined by <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a>.</dd></dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">T_COSE_ERR_SIG_STRUCT</td><td>Most likely this is because the protected_headers passed in is larger than T_COSE_SIGN1_MAX_PROT_HEADER. </td></tr>
    <tr><td class="paramname">T_COSE_ERR_UNSUPPORTED_HASH</td><td>If the hash algorithm is not known. </td></tr>
    <tr><td class="paramname">T_COSE_ERR_HASH_GENERAL_FAIL</td><td>In case of some general hash failure.</td></tr>
  </table>
  </dd>
</dl>
<p>The input to the public key signature algorithm in COSE is the hash of a CBOR encoded structure containing the protected headers algorithm ID and a few other things. This formats that structure and computes the hash of it. These are known as the to-be-signed or "TBS" bytes. </p>

</div>
</div>
<a id="a12cfd92c0a1b8b770c6c94a34fb8132c" name="a12cfd92c0a1b8b770c6c94a34fb8132c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12cfd92c0a1b8b770c6c94a34fb8132c">&#9670;&#160;</a></span>get_short_circuit_kid()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="t__cose__common_8h.html#a469580b586841b779bbdc430d3a0dd97">t_cose_err_t</a> get_short_circuit_kid </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structuseful__buf.html">useful_buf</a></td>          <td class="paramname"><span class="paramname"><em>buffer_for_kid</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structuseful__buf__c.html">useful_buf_c</a> *</td>          <td class="paramname"><span class="paramname"><em>kid</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get the special kid for short-circuit signing. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">buffer_for_kid</td><td>Pointer and length of buffer into which the resulting hash is put. It should always be at least <a class="el" href="#a92ba383acc7ea564561e83eb6aac7345">T_COSE_SHORT_CIRCUIT_KID_SIZE</a>. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">kid</td><td>Pointer and length of the returned kid.</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">T_COSE_SUCCESS</td><td>The kid was returned. </td></tr>
    <tr><td class="paramname">T_COSE_ERR_KEY_BUFFER_SIZE</td><td><code>buffer_for_kid</code> is too small</td></tr>
  </table>
  </dd>
</dl>
<p>This always returns the same key ID. It always indicates short-circuit signing. It is OK to hard code this as the probability of collision with this ID is extremely low and the same as for collision between any two key IDs (kids) of any sort.</p>
<p>This is the value of the kid. </p><pre class="fragment">   0xef, 0x95, 0x4b, 0x4b, 0xd9, 0xbd, 0xf6, 0x70,
   0xd0, 0x33, 0x60, 0x82, 0xf5, 0xef, 0x15, 0x2a,
   0xf8, 0xf3, 0x5b, 0x6a, 0x6c, 0x00, 0xef, 0xa6,
   0xa9, 0xa7, 0x1f, 0x49, 0x51, 0x7e, 0x18, 0xc6
</pre> 
</div>
</div>
<a id="a63d86375cb59d1a36b01b943a27790bf" name="a63d86375cb59d1a36b01b943a27790bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63d86375cb59d1a36b01b943a27790bf">&#9670;&#160;</a></span>hash_alg_id_from_sig_alg_id()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t hash_alg_id_from_sig_alg_id </td>
          <td>(</td>
          <td class="paramtype">int32_t</td>          <td class="paramname"><span class="paramname"><em>cose_sig_alg_id</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return hash algorithm ID from a signature algorithm ID. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cose_sig_alg_id</td><td>A COSE signature algorithm identifier.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>INT32_MAX</code> when the signature algorithm ID is not known.</dd></dl>
<p>This works off of algorithm identifiers defined in the [IANA COSE Registry] (<a href="https://www.iana.org/assignments/cose/cose.xhtml">https://www.iana.org/assignments/cose/cose.xhtml</a>). Corresponding local integer constants are defined in <a class="el" href="t__cose__defines_8h.html" title="Constants from COSE standard and IANA registry.">t_cose_defines.h</a>.</p>
<p>COSE signing algorithms are the combination of public key algorithm, curve, key size, hash algorithm and hash size. They are simple integers making them convenient for direct use in code.</p>
<p>This function returns an identifier for only the hash algorithm from the combined identifier.</p>
<p>If the needed algorithm identifiers are not in the IANA registry, they can be added to it. This will take some time and work. It is also fine to use algorithms in the proprietary space. </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_5fdebfbd0a4b5643a5e85bf3c8b1558b.html">mbed-os</a></li><li class="navelem"><a class="el" href="dir_d00fafdb9414f6e624fcf4d73ffde065.html">platform</a></li><li class="navelem"><a class="el" href="dir_a72924067aea8bbead751f11070268f4.html">FEATURE_EXPERIMENTAL_API</a></li><li class="navelem"><a class="el" href="dir_007a19531d3d09289f9f9c2cf309e91b.html">FEATURE_PSA</a></li><li class="navelem"><a class="el" href="dir_05e0d8a557d855fa23572451f1c8ea18.html">TARGET_MBED_PSA_SRV</a></li><li class="navelem"><a class="el" href="dir_ca746bf8ecd12d766019f43663efcc0b.html">services</a></li><li class="navelem"><a class="el" href="dir_923835f9769c78775a68e44a6b879543.html">attestation</a></li><li class="navelem"><a class="el" href="dir_7b21a9191e8d2f7f6543909a71e3be35.html">tfm_impl</a></li><li class="navelem"><a class="el" href="dir_a4b7aa45533a9103aefb0614264d6ac4.html">t_cose</a></li><li class="navelem"><a class="el" href="dir_323b101628e551f2af457ad0548e3030.html">src</a></li><li class="navelem"><a class="el" href="t__cose__util_8h.html">t_cose_util.h</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
